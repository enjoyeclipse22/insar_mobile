# InSAR Pro Mobile - 应用设计文档

## 应用概述

InSAR Pro Mobile 是一个完整的干涉合成孔径雷达（Interferometric Synthetic Aperture Radar）数据处理移动应用。用户可以通过移动设备执行 InSAR 处理的所有中间过程，包括数据下载、配准、干涉图生成、去相干、相位解缠和形变反演等。

**核心特性：**
- 支持 Sentinel-1 卫星数据的自动下载
- 完整的 InSAR 处理流程可视化
- 实时处理进度跟踪
- 交互式结果展示（干涉图、相干图、形变图）
- 处理历史管理和结果导出

---

## 屏幕列表

### 1. **主页（Home）**
- **功能：** 应用入口，显示快速操作和最近项目
- **内容：**
  - 欢迎信息和应用简介
  - "新建项目"按钮
  - 最近处理的项目列表（卡片形式）
  - 快速统计：总项目数、处理成功数
  - 设置和帮助链接

### 2. **项目列表（Projects）**
- **功能：** 管理所有 InSAR 处理项目
- **内容：**
  - 项目卡片列表（可滑动）
  - 每个卡片显示：项目名称、创建日期、处理状态、最后更新时间
  - 长按卡片可删除或导出
  - 搜索和筛选功能（按状态、日期）
  - 新建项目浮动按钮

### 3. **项目详情（Project Detail）**
- **功能：** 查看项目的完整处理流程和结果
- **内容：**
  - 项目基本信息（名称、位置、时间范围）
  - 处理流程步骤（折叠/展开）：
    - ✓ 数据下载
    - ✓ 轨道下载
    - ✓ DEM 下载
    - ✓ 配准
    - ✓ 干涉图生成
    - ✓ 去相干
    - ✓ 相位解缠
    - ✓ 形变反演
  - 每个步骤显示状态、耗时、错误信息
  - 结果预览（缩略图）
  - 导出按钮

### 4. **新建项目向导（Create Project Wizard）**
- **功能：** 引导用户创建新的 InSAR 处理项目
- **内容：**
  - **第 1 步 - 基本信息：**
    - 项目名称输入
    - 处理区域选择（地图选择或坐标输入）
    - 感兴趣区域 (AOI) 绘制
  - **第 2 步 - 数据参数：**
    - 时间范围选择（开始日期、结束日期）
    - 卫星选择（Sentinel-1A/B）
    - 轨道方向（升轨/降轨）
    - 极化方式（VV/VH/HH/HV）
  - **第 3 步 - 处理参数：**
    - 相干性阈值
    - 相位解缠方法选择
    - 高通滤波参数
    - 输出分辨率
  - **第 4 步 - 确认：**
    - 参数总结
    - 预计处理时间
    - 开始处理按钮

### 5. **处理监控（Processing Monitor）**
- **功能：** 实时显示处理进度和日志
- **内容：**
  - 进度条（总体进度）
  - 当前处理步骤详情
  - 实时日志窗口（可滑动）
  - 暂停/继续/取消按钮
  - 处理耗时统计
  - 内存和 CPU 使用率（如可获取）

### 6. **结果展示（Results Viewer）**
- **功能：** 交互式查看处理结果
- **内容：**
  - **选项卡：**
    - 干涉图（Interferogram）
    - 相干图（Coherence）
    - 形变图（Deformation）
    - 高程图（DEM）
  - 图像显示：
    - 缩放、平移、旋转功能
    - 颜色条和数值范围显示
    - 统计信息（最小值、最大值、平均值）
  - 导出按钮（PNG、GeoTIFF、NetCDF）
  - 分享功能

### 7. **数据管理（Data Management）**
- **功能：** 管理下载的原始数据和中间产品
- **内容：**
  - 存储空间统计
  - 数据分类显示：
    - 原始 SLC 数据
    - 轨道数据
    - DEM 数据
    - 处理中间产品
    - 最终结果
  - 每项数据显示大小、日期、来源
  - 删除和备份功能

### 8. **设置（Settings）**
- **功能：** 应用配置和用户偏好
- **内容：**
  - **处理设置：**
    - 默认处理参数
    - 并行处理线程数
    - 内存限制
  - **存储设置：**
    - 数据存储位置
    - 自动清理过期数据
    - 备份选项
  - **显示设置：**
    - 主题（亮/暗）
    - 语言选择
    - 单位系统（米/厘米）
  - **关于：**
    - 应用版本
    - 许可证信息
    - 反馈和支持

---

## 主要用户流程

### 流程 1：完整的 InSAR 处理工作流
1. 用户在主页点击"新建项目"
2. 进入向导，依次填写基本信息、数据参数、处理参数
3. 确认后进入处理监控页面
4. 应用自动执行：数据下载 → 配准 → 干涉图生成 → 去相干 → 相位解缠 → 形变反演
5. 处理完成后自动跳转到结果展示页面
6. 用户可查看各类结果图像、导出数据、分享结果

### 流程 2：查看历史项目
1. 用户在主页或项目列表中选择已有项目
2. 进入项目详情页面
3. 查看处理流程的每个步骤状态
4. 可重新运行某个步骤或导出结果

### 流程 3：管理存储空间
1. 用户进入数据管理页面
2. 查看各类数据占用的空间
3. 可选择删除不需要的中间产品或原始数据
4. 设置自动清理策略

---

## 核心功能模块

### 1. **数据获取模块**
- Sentinel-1 SLC 数据自动下载（ASF、USGS API）
- 精密轨道数据下载
- SRTM DEM 数据下载和处理
- 土地掩膜数据获取

### 2. **数据处理模块**
- **配准（Coregistration）：** 主从影像精确配准
- **干涉图生成（Interferogram）：** 计算干涉相位
- **去相干（Denoising）：** 高斯滤波、适应性滤波
- **相位解缠（Phase Unwrapping）：** 支持多种算法（SNAPHU、ISCE）
- **地理编码（Geocoding）：** 坐标转换和投影
- **形变反演（Deformation Inversion）：** LOS 位移计算

### 3. **可视化模块**
- 干涉图彩色渲染
- 相干图灰度显示
- 形变图热力图显示
- 3D 形变可视化（可选）
- 交互式地图集成

### 4. **数据管理模块**
- 项目元数据存储（SQLite/本地数据库）
- 处理结果缓存管理
- 数据版本控制
- 导出和备份功能

### 5. **日志和监控模块**
- 实时处理日志记录
- 错误追踪和调试信息
- 性能监控（内存、CPU、耗时）
- 处理历史查询

---

## 设计原则

### 移动优先（Mobile-First）
- 所有界面基于 **9:16 纵向屏幕** 设计
- 支持单手操作，关键按钮位于屏幕下半部分
- 响应式布局，适配各种屏幕尺寸

### 渐进式信息披露
- 主页显示关键信息和快速操作
- 详情页面逐步展开复杂内容
- 向导式流程引导用户完成复杂任务

### 清晰的状态反馈
- 处理状态用颜色和图标清晰表示（进行中、成功、失败、等待）
- 实时进度条显示处理进度
- 错误信息清晰且可操作

### 性能优化
- 大数据集使用虚拟列表（FlatList）
- 图像结果使用缩略图预加载
- 后台处理不阻塞 UI

---

## 色彩方案

| 用途 | 浅色 | 深色 |
|------|------|------|
| 主色调（Primary） | #0066CC | #4DA6FF |
| 背景（Background） | #FFFFFF | #0F0F0F |
| 表面（Surface） | #F5F5F5 | #1A1A1A |
| 前景文字（Foreground） | #1A1A1A | #FFFFFF |
| 成功（Success） | #22C55E | #4ADE80 |
| 警告（Warning） | #F59E0B | #FBBF24 |
| 错误（Error） | #EF4444 | #F87171 |
| 处理中（Processing） | #3B82F6 | #60A5FA |

---

## 技术架构

### 前端框架
- **React Native** + **Expo** 用于跨平台开发
- **Expo Router** 用于导航
- **NativeWind** (Tailwind CSS) 用于样式
- **Reanimated** 用于动画效果

### 后端处理
- **Python** 后端（使用 FastAPI/Flask）
- **PyGMTSAR** 或 **MintPy** 库用于 InSAR 处理
- **GDAL/Rasterio** 用于地理数据处理
- **NumPy/SciPy** 用于数值计算

### 数据存储
- **SQLite** 存储项目元数据和处理历史
- **本地文件系统** 存储原始数据和结果
- **GeoTIFF/NetCDF** 格式存储地理栅格数据

### 通信
- **REST API** 用于前后端通信
- **WebSocket** 用于实时处理日志流
- **gRPC**（可选）用于高性能数据传输

---

## 开发优先级

### 第 1 阶段（MVP）
- [ ] 主页和项目列表
- [ ] 新建项目向导（简化版）
- [ ] 基础处理流程（数据下载 → 干涉图生成）
- [ ] 结果展示（干涉图查看）
- [ ] 项目管理（删除、重命名）

### 第 2 阶段
- [ ] 完整处理流程（相位解缠、形变反演）
- [ ] 高级结果展示（多图层、交互式地图）
- [ ] 数据管理页面
- [ ] 处理参数高级选项

### 第 3 阶段
- [ ] 3D 可视化
- [ ] 云端同步和备份
- [ ] 用户账户和分享功能
- [ ] 离线处理支持

---

## 注意事项

1. **计算资源：** InSAR 处理计算量大，建议在后端服务器执行，移动应用主要负责 UI 和结果展示。
2. **数据大小：** Sentinel-1 数据量大（GB 级），需要合理管理存储空间。
3. **网络依赖：** 数据下载需要稳定的网络连接，建议支持断点续传。
4. **用户体验：** 长时间处理需要清晰的进度反馈，避免用户误认为应用卡死。
